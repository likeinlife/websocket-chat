# FastAPI + FastStream + RabbitMQ чат

Чат на вебсокетах и событийной системе

# Архитектура

Приложение построено на событийной системе, использующий паттерн "Посредник"(Mediator)

Ключевые составляющие Mediator:
1. Command, CommandHandler - команды и хендлеры для команд. Команды необходимы для каких-либо действий, меняющих состояние. Например, создание/удаление/редактирование объекта
2. Event, EventHandler - события и хендлеры для событий. События могут вызываться из любого места. Событием может быть результат выполнения команд, поступление новых данных от брокера и т.д.
3. Query, QueryHandler - запросы и обработчики запросов. Запросы необходимы для получения данных из системы.

Кроме того, приложение также выстроено по DDD:
1. Выделена доменная область - `domain`. В ней определены основные сущности, ошибки, события.
2. Выделен слой инфраструктуры - `infra`. В нем определена логика взаимодействия с внешними системами: вебсокеты, репозитории
3. Определен слой логики - `logic`. В нем содержится вся основная бизнес-логика. В проекте в нем содержатся медиаторы и сериализаторы
4. Выделен слой представления - `application`. В нем содержится, соответственно, вся логика работы с пользователем - через интерфейс FastAPI и FastStream
5. В корне проекта расположен `container.py` - DI контейнер.

## Плюсы и минусы архитектуры

Плюсы:
- Части проекта не связаны друг с другом. В любом момент, при необходимости, можно подменить какую-либо из зависимостей. Например, вместо In-Memory репозиториев сообщений и чатов, можно написать на PostgreSQL.
- При совместной разработке меньше шансов нарваться на конфликт.
- С одной командой можно связать несколько событий. Например, легко транслировать сообщение сразу в несколько источников.

Минусы:
- В уже написанный код тяжело вносить изменения: менять доменную модель и т.д..
- Тяжело разобраться в комплексной структуре. У меня заняло 48 часов, чтобы осознать, что происходит.

# Стек

1. Python3
2. FastAPI
3. FastStream
4. RabbitMQ
5. DependencyInjector
6. Docker, docker-compose
7. poetry
8. ruff, mypy, pre-commit
9. structlog